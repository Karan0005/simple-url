<!-- Navbar -->
<nav class="navbar navbar-dark">
    <div class="container">
        <a class="navbar-brand" href="#">Short Link Manager</a>
    </div>
</nav>

<div class="container mt-5">
    <ul class="nav nav-tabs" id="linkTabs">
        <li class="nav-item">
            <button
                class="nav-link active"
                id="create-tab"
                data-bs-toggle="tab"
                data-bs-target="#create"
                type="button"
                role="tab"
                aria-controls="create"
                aria-selected="true"
            >
                Create Short Link
            </button>
        </li>
        <li class="nav-item">
            <button
                class="nav-link"
                id="manage-tab"
                data-bs-toggle="tab"
                data-bs-target="#manage"
                type="button"
                role="tab"
                aria-controls="manage"
                aria-selected="false"
                (click)="list('')"
            >
                Manage Short Links
            </button>
        </li>
    </ul>

    <div class="tab-content" id="linkTabsContent">
        <!-- Create Short Link Section -->
        <div
            class="tab-pane fade show active"
            id="create"
            role="tabpanel"
            aria-labelledby="create-tab"
        >
            <div class="card mt-4">
                <div class="card-body">
                    <form>
                        <div class="mb-3">
                            <label for="longUrl" class="form-label">Long URL</label>
                            <input
                                name="originalLink"
                                type="url"
                                class="form-control"
                                id="longUrl"
                                placeholder="Enter your long URL"
                                required
                                [(ngModel)]="shortLinkRequest.OriginalLink"
                            />
                        </div>
                        <div class="form-check form-switch mb-3">
                            <input
                                name="qrCodeSwitch"
                                class="form-check-input"
                                type="checkbox"
                                id="qrCodeSwitch"
                                [(value)]="isQRCodeEnabled"
                                (change)="onQrCodeSwitchChange($event)"
                            />
                            <label class="form-check-label" for="qrCodeSwitch"
                                >Generate QR Code</label
                            >
                            <div id="qrHelp" class="form-text">
                                Choose to create a downloadable QR code instead of a short link.
                            </div>
                        </div>
                        <div class="mb-3" *ngIf="!isQRCodeEnabled">
                            <label for="expiry" class="form-label">Expiration</label>
                            <select
                                name="expiry"
                                class="form-select"
                                id="expiry"
                                [(ngModel)]="shortLinkRequest.ExpireTime"
                            >
                                <option *ngFor="let expire of linkExpiry" [value]="expire.value">
                                    {{ expire.label }}
                                </option>
                            </select>
                        </div>

                        <button type="button" class="btn btn-primary w-100" (click)="convert()">
                            Convert
                        </button>
                    </form>
                    <div class="mb-3" *ngIf="shortLink && !isQRCodeEnabled">
                        <label for="shortUrl" class="form-label">Short URL</label>
                        <input
                            name="shortLink"
                            type="url"
                            class="form-control"
                            id="shortUrl"
                            readonly
                            [(ngModel)]="shortLink"
                        />
                    </div>

                    <div
                        *ngIf="isQRCodeEnabled"
                        [ngClass]="{ 'display-none': !downloadableQRImage }"
                    >
                        <canvas #canvas></canvas>
                        <a href="{{ downloadableQRImage }}" download="qrcode.jpg">
                            Download QR Code
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Manage Short Links Section -->
        <div class="tab-pane fade" id="manage" role="tabpanel" aria-labelledby="manage-tab">
            <div class="card mt-4">
                <div class="card-body">
                    <div class="mb-3">
                        <label for="searchShortLink" class="form-label">Search Short Link</label>
                        <input
                            type="text"
                            class="form-control"
                            id="searchShortLink"
                            placeholder="Enter short link to search"
                            (input)="onSearchChange($event)"
                        />
                    </div>

                    <div class="table-responsive mt-4">
                        <table class="table table-bordered">
                            <thead class="table-light">
                                <tr>
                                    <th>Original URL</th>
                                    <th>Short Link</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let data of shortLinkList.ShortLinks">
                                    <td>
                                        <span *ngIf="editingShortLink !== data.ShortLink">{{
                                            data.OriginalLink
                                        }}</span>
                                        <input
                                            *ngIf="editingShortLink === data.ShortLink"
                                            type="text"
                                            class="form-control"
                                            [(ngModel)]="data.OriginalLink"
                                        />
                                    </td>
                                    <td>{{ shortLinkList.LinkBaseURL + '/' + data.ShortLink }}</td>
                                    <td>
                                        <span class="badge bg-primary" *ngIf="!data.IsDisabled"
                                            >Active</span
                                        >
                                        <span class="badge bg-danger" *ngIf="data.IsDisabled"
                                            >Disabled</span
                                        >
                                    </td>
                                    <td>
                                        <button
                                            *ngIf="editingShortLink !== data.ShortLink"
                                            class="btn btn-secondary btn-sm me-2"
                                            (click)="editOriginalLink(data.ShortLink)"
                                        >
                                            Edit
                                        </button>
                                        <button
                                            *ngIf="editingShortLink === data.ShortLink"
                                            class="btn btn-primary btn-sm me-2"
                                            (click)="saveOriginalLink(data.OriginalLink)"
                                        >
                                            Save
                                        </button>
                                        <button
                                            class="btn btn-warning btn-sm me-2"
                                            *ngIf="!data.IsDisabled"
                                            (click)="updateStatus(data.ShortLink, true)"
                                        >
                                            Disable
                                        </button>
                                        <button
                                            class="btn btn-warning btn-sm me-2"
                                            *ngIf="data.IsDisabled"
                                            (click)="updateStatus(data.ShortLink, false)"
                                        >
                                            Activate
                                        </button>
                                        <button
                                            class="btn btn-danger btn-sm me-2"
                                            (click)="delete(data.ShortLink)"
                                        >
                                            Delete
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
